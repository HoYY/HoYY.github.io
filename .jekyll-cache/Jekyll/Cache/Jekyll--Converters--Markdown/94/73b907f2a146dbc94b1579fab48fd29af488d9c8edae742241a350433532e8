I"Ş<p>[í™˜ê²½]<br />
Spring Tool Suite(STS) 3.9.5 RELEASE<br />
Spring Boot 2.1.8.RELEASE<br />
jdk 1.8.0_181<br />
MySQL 8.0.17</p>

<p>ì €ë²ˆ í¬ìŠ¤í„°ì—ì„œ JPA ManyToMany ê´€ê³„ì— ëŒ€í•´ì„œ ì‚´í´ë´¤ìŠµë‹ˆë‹¤. Entity êµ¬ì„±ì´ ëë‚¬ìœ¼ë‹ˆ ì´ì œ ManyToMany ê´€ê³„ì—ì„œ ì–´ë–»ê²Œ Join í…Œì´ë¸”ì— ì ‘ê·¼í•˜ëŠ”ì§€ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤.<br />
Spring Data JPAì˜ JpaRepositoryë¥¼ ì‚¬ìš©í•  ê²½ìš° ê¸°ë³¸ì ì¸ SELECT, INSERT, DELETE ì¿¼ë¦¬ë¥¼ ë©”ì†Œë“œëª…ì˜ ì¡°í•©ìœ¼ë¡œ ì‘ì„±í•  ìˆ˜ ìˆëŠ”ë°, UPDATE ì¿¼ë¦¬ì˜ ê²½ìš° @Query ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.<br />
ì´ë²ˆ í¬ìŠ¤í„°ì—ì„œëŠ” ì´ ë‘ ê°€ì§€ ë‚´ìš©ì„ ë‹¤ë¤„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p>

<p class="lead">&lt;!â€“-break-â€“&gt;</p>

<h1 id="1-manytomany-query">1. @ManyToMany @Query</h1>

<p>@JoinTable ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” board_tag í…Œì´ë¸”ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¼ ì–´ë–»ê²Œ board_tag í…Œì´ë¸”ì— CRUD(Create, Read, Update, Delete)ë¥¼ ìˆ˜í–‰í• ê¹Œìš”?<br />
<strong>Create(INSERT)</strong>ì˜ ê²½ìš° Board í´ë˜ìŠ¤ì˜ addTags() ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•´ Boardì— í•´ë‹¹í•˜ëŠ” Tagë¥¼ ë”í•´ì£¼ê³ , BoardRepositoryì˜ save() ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•´ board í…Œì´ë¸”ì— INSERT í•  ë•Œ board_tag í…Œì´ë¸”ë„ ê°™ì´ INSERT í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<pre><code>@Autowired
private BoardRepository boardRepository;

Board board = new Board();
Tag tag1 = new Tag();
Tag tag2 = new Tag();
Tag tag3 = new Tag();
board.addTags(tag1);
board.addTags(tag2);
board.addTags(tag3);
boardRepository.save(board);
</code></pre>

<p><strong>Read(SELECT)</strong>ì˜ ê²½ìš° Board í´ë˜ìŠ¤ì˜ getTags() ë©”ì†Œë“œë¥¼ í†µí•´ í•´ë‹¹ Boardì— ì†í•´ìˆëŠ” Tagë“¤ì„ ì–»ì„ ìˆ˜ ìˆë‹¤. ê·¸ë ‡ë‹¤ë©´ Board Entityë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ì•Šê³  boardNo(id)ë¥¼ ì‚¬ìš©í•˜ì—¬ Tagë“¤ë§Œ ê°€ì ¸ì˜¤ëŠ” ë°©ë²•ì´ ìˆì„ê¹Œìš”?<br />
@Query ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ë©´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ JPA ëª¨ë“ˆì€ ì¿¼ë¦¬ë¥¼ ë©”ì†Œë“œ ì´ë¦„ì—ì„œ íŒŒìƒë˜ë„ë¡ ì§€ì›í•©ë‹ˆë‹¤.</p>
<pre><code>Board findBoardByBoardNo(int boardNo);</code></pre>

<p>í•˜ì§€ë§Œ ëª¨ë“  ì¿¼ë¦¬ë¥¼ ë©”ì†Œë“œ ì´ë¦„ë§Œìœ¼ë¡œ ìë™ìœ¼ë¡œ ìƒì„±í•  ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ì¡´ì¬í•˜ëŠ” ê²ƒì´ @Query ì–´ë…¸í…Œì´ì…˜ì…ë‹ˆë‹¤.</p>
<pre><code>//BoardRepotiroy
@Query("select b from Board b inner join b.tags bt where bt.no = ?1")
List&lt;Board&gt; findBoardsByTagNo(int no);
</code></pre>

<p>ìœ„ì™€ ê°™ì´ Board Entityì™€ Boardì˜ tags Setì„ Join í•´ì£¼ë©´ ë©ë‹ˆë‹¤. ì—¬ê¸°ì„œ <strong>bt</strong>ê°€ Boardì˜ tagsë¼ëŠ” ê²ƒì„ ìŠìœ¼ë©´ ì•ˆ ë©ë‹ˆë‹¤. <strong>bt.no</strong>ëŠ” Tag Entityì˜ no ì†ì„±ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ê·¸ë ‡ë‹¤ë©´ ë°˜ëŒ€ë¡œ Boardì˜ id ê°’ìœ¼ë¡œ Tagë¥¼ ì°¾ìœ¼ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”?</p>
<pre><code>//TagRepotiroy
@Query("select t from Tag t inner join t.boards bt where bt.boardNo = ?1")
List&lt;Tag&gt; findTagsByBoardNo(int boardNo);
</code></pre>

<p>ë§Œì•½ Board Entityì˜ id ì†ì„±ëª…ì´ â€˜boardNoâ€™ê°€ ì•„ë‹ˆë¼ â€˜noâ€™ ì˜€ë‹¤ë©´ where ì ˆì´ findBoardsByTagNo()ì™€ ê°™ì´ <strong>â€˜bt.no = ?1â€™</strong>ì´ ë©ë‹ˆë‹¤.<br />
ê°œì¸ì ìœ¼ë¡œ ì´ ë¶€ë¶„ì´ ì •ë§ í–‡ê°ˆë ¸ìŠµë‹ˆë‹¤.</p>

<p><strong>Delete(DELETE)</strong>ì˜ ê²½ìš° ë§¤ìš° ê°„ë‹¨í•©ë‹ˆë‹¤. Board Entityì˜ id ê°’ë§Œ ì•Œë©´ BoardRepositoryì˜ deleteById() ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ í•´ë‹¹ Boardì™€ Boardì— ì†í•´ìˆëŠ” tags Setê¹Œì§€ ì œê±°í•˜ì—¬ board_tag í…Œì´ë¸”ì˜ íŠœí”Œì„ ì œê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<pre><code>@Autowired
private BoardRepository boardRepository;

boardRepository.deleteById(boardNo);</code></pre>

<p><strong>Update(UPDATE)</strong>ê°€ ê°€ì¥ ê³¨ì¹˜ ì•„í”ˆ ê²½ìš°ì˜€ìŠµë‹ˆë‹¤. ì§ê´€ì ìœ¼ë¡œ ìƒê°í•´ë³´ë©´ Board í´ë˜ìŠ¤ì˜ setTags(); ë©”ì†Œë“œë¥¼ ì¨ì„œ í•´ë‹¹ Boardì˜ tags Setì„ ë°”ê¿”ì£¼ë©´ ì •ìƒì ìœ¼ë¡œ Updateê°€ ë  ê²ƒ ê°™ì§€ë§Œ ë§‰ìƒ ì‹œë„í•´ë³´ë©´ ì´ìƒí•œ ê²°ê³¼ê°€ ë‚˜ì˜µë‹ˆë‹¤.<br />
Boardì˜ tagsì— â€˜Aâ€™ Tagê°€ ìˆì—ˆëŠ”ë° setTags()ë¥¼ í†µí•´ â€˜Aâ€™, â€˜Bâ€™ Tagë“¤ì„ ê°€ì§€ê³  ìˆëŠ” tagsë¡œ ë°”ê¿”ì£¼ë©´ DBì˜ tag í…Œì´ë¸”ì—ëŠ” â€˜Aâ€™, â€˜Aâ€™, â€˜Bâ€™ê°€ ë“¤ì–´ê°€ê²Œ ë©ë‹ˆë‹¤.<br />
ì´ ë¬¸ì œëŠ” ORMì— ëŒ€í•œ ì´í•´ ë¶€ì¡±ì´ ì›ì¸ì´ì—ˆìŠµë‹ˆë‹¤. ë‹¨ìˆœí•˜ê²Œ â€˜Aâ€™ë¼ëŠ” Stringì„ DBì— ì €ì¥í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ Tag Entityë¥¼ í†µí•´ DBì— ê°’ì„ ì „ë‹¬í•˜ê¸° ë•Œë¬¸ì— Tag Entity ê°ì²´ë¥¼ ìƒˆë¡­ê²Œ ë§Œë“¤ì–´ì£¼ë©´ Tag í…Œì´ë¸”ì˜ tag Columnì´ ìœ ë‹ˆí¬ Columnì´ë¼ë„ ë‹¤ë¥¸ ê°ì²´ë¡œ ì¸ì‹ë˜ì–´ â€˜Aâ€™, â€˜Aâ€™ê°€ ì €ì¥ë˜ëŠ” í˜„ìƒì´ ë°œìƒí•©ë‹ˆë‹¤. ì €ëŠ” ì´ì™€ ê°™ì€ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ê°„ë‹¨í•œ ë©”ì†Œë“œë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.</p>
<pre><code>private void addTags(Board board, String[] tags) {
	board.getTags().clear();
	Tag tag;
	for(String s : tags) {
		if(!isEmpty(s)) {
			if(!tagRepository.existsByTag(s)) {
				tag = new Tag(s);
				tagRepository.save(tag);
				log.info("insert new tag");
			}
			else {
				tag = tagRepository.findByTag(s);
				log.info("find a tag");
			}
			board.addTags(tag);
		}
	}
}
</code></pre>

<hr />

<h1 id="2-spring-data-jpa-update-query">2. Spring Data JPA Update Query</h1>
<p>JpaRepositoryì—ì„œ @Query ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ UPDATE ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ê²½ìš° ì¼ë°˜ì ì¸ SELECT ì¿¼ë¦¬ì™€ ë‹¤ë¥´ê²Œ @Modifying ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.</p>
<pre><code>@Modifying
@Query("update Board b set b.title = ?1, b.contents = ?2, b.writer = ?3, b.date = ?4"
		+ ", b.tags = ?5 where b.boardNo = ?6")
void updateBoardByBoardNo(String title, String contents, String writer, String date, Set<Tag> tags, int boardNo);
&lt;/code&gt;&lt;/pre&gt;

---
[ì°¸ê³  ì‚¬ì´íŠ¸]  
&lt;https://www.baeldung.com/spring-data-jpa-query&gt;
</Tag></code></pre>
:ET