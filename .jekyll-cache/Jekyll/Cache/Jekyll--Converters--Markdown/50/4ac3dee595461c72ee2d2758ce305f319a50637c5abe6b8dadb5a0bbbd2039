I"Ê+<p>[í™˜ê²½]<br />
Spring Tool Suite(STS) 3.9.5 RELEASE<br />
Spring Boot 2.1.8.RELEASE<br />
jdk 1.8.0_181<br />
MySQL 8.0.17</p>

<p>ì´ë²ˆ í¬ìŠ¤í„°ì—ì„œëŠ” Hibernate Search, Luceneì„ ì‚¬ìš©í•˜ëŠ” ê²€ìƒ‰ ê¸°ëŠ¥ì— ëŒ€í•´ì„œ ë‹¤ë¤„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.<br />
ì•ì—ì„œ ì–¸ê¸‰í–ˆë‹¤ì‹œí”¼ ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„  ORMì„ ìœ„í•´ Hibernateì™€ JPAë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. ì´ë¯¸ Hibernateì™€ JPAë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤ë©´ ì¶”ê°€ ì„¤ì • ì—†ì´ ì•„ì£¼ ì‰½ê²Œ Hibernate Searchë¥¼ ì´ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ê³ ì„±ëŠ¥ì˜ í™•ì¥ ê°€ëŠ¥í•œ Full-Text ê²€ìƒ‰ ì—”ì§„ ë¼ì´ë¸ŒëŸ¬ë¦¬ì¸ Apache Luceneì„ ì§ì ‘ì ìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ ê°•ë ¥í•œ ë¶„ì„ í”„ë ˆì„ì›Œí¬ì˜ ëª¨ë“  ê¸°ëŠ¥ì„ ì œê³µí•  ìˆ˜ ìˆë‹¤ê³  ê³µì‹ í™ˆí˜ì´ì§€ì— ë‚˜ì™€ìˆìŠµë‹ˆë‹¤.<br />
ElasticSearchì™€ë„ í†µí•©í•˜ì—¬ í™•ì¥ì´ ê°€ëŠ¥í•˜ë‹¤ê³  ë‚˜ì™€ìˆì§€ë§Œ ì´ë²ˆ WIKI í”„ë¡œì íŠ¸ì— ê·¸ì •ë„ ê¹Œì§€ëŠ” í•„ìš” ì—†ì„ ê²ƒ ê°™ìœ¼ë‹ˆ ë‹¤ë£¨ì§€ ì•Šë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.<br />
ë˜í•œ ìµœê·¼ì—ëŠ”(2019-09-24) Hibernate Search 6.0.0.Beta1 ë²„ì „ì´ ì¶œì‹œë˜ì—ˆìŠµë‹ˆë‹¤.<br />
<a href="https://hibernate.org/search/">https://hibernate.org/search/</a></p>

<p class="lead">&lt;!â€“-break-â€“&gt;</p>

<h1 id="1-buildgradle-dependencies-ì¶”ê°€">1. build.gradle dependencies ì¶”ê°€</h1>

<p>ë¨¼ì € Gradleì— ì˜ì¡´ì„±ì„ ì¶”ê°€í•´ì¤ë‹ˆë‹¤.</p>
<pre><code>dependencies {
...
implementation 'org.hibernate:hibernate-search-orm:5.11.1.Final'
...
}
</code></pre>

<p>dependenciesë¥¼ ì¶”ê°€í–ˆìœ¼ë©´ Refresh Gradle Projectë¥¼ ëˆŒëŸ¬ ìµœì‹ í™”ë¥¼ ì‹œì¼œì¤ë‹ˆë‹¤.</p>

<hr />

<h1 id="2-directory-configuration">2. Directory Configuration</h1>

<p>ë‹¤ìŒìœ¼ë¡œ Springì˜ ì„¤ì •íŒŒì¼ì¸ application.propertiesì— ì¸ë±ìŠ¤ë¥¼ ì €ì¥í•  ìœ„ì¹˜ë¥¼ ëª…ì‹œí•´ ì¤ë‹ˆë‹¤. yamlì„ ì‚¬ìš©í•  ê²½ìš° application.ymlì— ì ì–´ì¤ë‹ˆë‹¤.</p>
<pre><code>//application.properties
spring.jpa.properties.hibernate.search.default.directory_provider=filesystem
spring.jpa.properties.hibernate.search.indexBase=D:/tmp
</code></pre>

<pre><code>//application.yml
spring:
  jpa:
    properties:
      hibernate:
        search:
          default:
            directory_provider: filesystem
            indexBase: D:/tmp
</code></pre>

<p><strong>directory_provider=filesystem</strong>ìœ¼ë¡œ ì„¤ì •í•  ê²½ìš° íŒŒì¼ì‹œìŠ¤í…œ ê¸°ë°˜ ë””ë ‰í† ë¦¬ë¥¼ ì¸ë±ìŠ¤ ì €ì¥ì— ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ë˜í•œ <strong>indexBase</strong>ë¡œ ì„¤ì •í•œ ë””ë ‰í† ë¦¬ê°€ ì—†ì„ ê²½ìš° ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤. ì‚¬ìš©ë˜ëŠ” ë””ë ‰í† ë¦¬ëŠ” <indexBase>/<indexName>ì…ë‹ˆë‹¤.
&lt;https://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#search-configuration-directory&gt;</indexName></indexBase></p>

<hr />

<h1 id="3-entity-configuration">3. Entity Configuration</h1>

<p>ì´ì œ ê²€ìƒ‰ì— ì‚¬ìš©í•  Entity í´ë˜ìŠ¤ì— ì¸ë±ì‹±ì„ ìœ„í•œ <strong>@Indexed, @Field</strong> ì–´ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•´ì¤ë‹ˆë‹¤.</p>
<pre><code>@Entity
<u><strong>@Indexed</strong></u>
@Getter
@Setter
@Table(name="board")
public class Board {
    @Id
    @GeneratedValue(strategy=GenerationType.AUTO)
    @Column(name="no", length=10)
    private int boardNo;
	
    @ManyToMany(cascade=CascadeType.PERSIST)
    @JoinTable(name="board_tag", joinColumns = {@JoinColumn(name="board_no")},
            inverseJoinColumns = {@JoinColumn(name="tag_no")})
    private Set&lt;Tag&gt; tags = new HashSet&lt;&gt;();
	
    <u><strong>@Field</strong></u>
    @NotNull
    @Column(length=50)
    private String title;

    ...
    
    public void addTags(Tag tag) {
        tags.add(tag);
    }
}</code></pre>

<p><strong>@Indexed</strong> ì–´ë…¸í…Œì´ì…˜ì€ ì¸ë±ì‹±í•  Entityë¥¼ ëª…ì‹œí•´ ì£¼ëŠ” ê²ƒì´ê³ , <strong>@Field</strong> ì–´ë…¸í…Œì´ì…˜ì€ Entity í´ë˜ìŠ¤ì—ì„œ ì–´ë–¤ ì»¬ëŸ¼ì„ ê²€ìƒ‰ì— ì‚¬ìš©í•  ê²ƒì¸ì§€ë¥¼ ëª…ì‹œí•´ì£¼ëŠ” ê²ƒì…ë‹ˆë‹¤. ê²€ìƒ‰í•˜ê¸°ìœ„í•œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ë•Œ onFields() ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì—¬ëŸ¬ ì»¬ëŸ¼ì„ ê²€ìƒ‰í•˜ê±°ë‚˜ ì¿¼ë¦¬ë¥¼ ì—¬ëŸ¬ê°œ ì‘ì„±í•˜ì—¬ ì—¬ëŸ¬ ì»¬ëŸ¼ì„ ê²€ìƒ‰í•  ê²ƒì´ë¼ë©´ í•´ë‹¹ ì»¬ëŸ¼ë“¤ì— <strong>@Field</strong> ì–´ë…¸í…Œì´ì…˜ì„ ëª…ì‹œí•´ ì£¼ë©´ ë©ë‹ˆë‹¤.<br />
ì €ëŠ” title, contents, writer ì»¬ëŸ¼ë“¤ì„ onFields() ë©”ì†Œë“œë¥¼ í†µí•´ ê²€ìƒ‰í•˜ë ¤ í–ˆì§€ë§Œ, ì•„ë¦¬ë‘ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì ìš©í•  ê²½ìš° ê²€ìƒ‰ì´ ì •ìƒì ìœ¼ë¡œ ë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤. ë•Œë¬¸ì— ì €ëŠ” title ì»¬ëŸ¼ í•˜ë‚˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ê²€ìƒ‰ ì¿¼ë¦¬ë¥¼ êµ¬ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.</p>

<hr />

<h1 id="4-hibernatesearchservice-í´ë˜ìŠ¤">4. HibernateSearchService í´ë˜ìŠ¤</h1>

<p>ë‹¤ìŒìœ¼ë¡œ ì¿¼ë¦¬ ë“± Hibernate Searchë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì½”ë“œë“¤ë¡œ êµ¬ì„±ë˜ì–´ ìˆëŠ” HibernateSearchService í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p>
<pre><code>FullTextEntityManager fullTextEntityManager = Search.getFullTextEntityManager(entityManager);
fullTextEntityManager.createIndexer().startAndWait();
</code></pre>

<p>ìœ„ì˜ ì½”ë“œëŠ” FullTextEntityManagerë¥¼ í†µí•´ ê²€ìƒ‰ì— ì‚¬ìš©ë  ì¸ë±ìŠ¤ë¥¼ ë§Œë“œëŠ” ì½”ë“œì…ë‹ˆë‹¤. FullTextEntityManagerëŠ” Full-Text ê¸°ëŠ¥ì„ ìœ„í•´ EntityManagerë¥¼ í™•ì¥í•œ ê°ì²´ì…ë‹ˆë‹¤. ìœ„ì˜ ì½”ë“œë¥¼ ë©”ì†Œë“œë¡œ ë§Œë“¤ì–´ ìƒˆë¡œìš´ ê¸€ì„ ì‘ì„±í•˜ê±°ë‚˜ ê¸°ì¡´ ê¸€ì„ ìˆ˜ì •í•  ë•Œ ì¸ë±ìŠ¤ë¥¼ ë‹¤ì‹œ ë¹Œë“œí•˜ì—¬ ìµœì‹ ì˜ ìƒíƒœë¥¼ ìœ ì§€í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤.<br />
<a href="http://hibernate.org/search/documentation/getting-started/#indexing">http://hibernate.org/search/documentation/getting-started/#indexing</a></p>

<p>ë‹¤ìŒìœ¼ë¡œëŠ” ì¿¼ë¦¬ë¥¼ ìƒì„±í•´ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë©”ì†Œë“œë¥¼ ë§Œë“¤ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.<br />
ë¨¼ì € ìœ„ì™€ ê°™ì´ FullTextEntityManagerë¥¼ ìƒì„±í•´ì£¼ê³  Lucene ì¿¼ë¦¬ë¥¼ ë§Œë“¤ê¸° ìœ„í•œ QueryBuilder ê°ì²´ë¥¼ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤. ì•„ë˜ì˜ ì½”ë“œ ì¤‘ forEntity() ë©”ì†Œë“œì—ëŠ” ì¿¼ë¦¬ì— ì‚¬ìš©í•  Entity í´ë˜ìŠ¤ë¥¼ ì¸ìê°’ìœ¼ë¡œ ë„£ì–´ì¤˜ì•¼ í•©ë‹ˆë‹¤.</p>
<pre><code>FullTextEntityManager fullTextEntityManager = Search.getFullTextEntityManager(entityManager);
QueryBuilder queryBuilder = fullTextEntityManager.getSearchFactory()
                             .buildQueryBuilder().forEntity(Board.class).get();
</code></pre>

<p>ì´ì œ ê²€ìƒ‰ì— ì‚¬ìš©í•  ì¿¼ë¦¬ë¥¼ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤. ê°€ì¥ ê¸°ë³¸ì ì¸ Keyword ì¿¼ë¦¬ë¥¼ ë§Œë“¤ì–´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p>
<pre><code>Query query = queryBuilder.keyword().onField("title")
                .matching(keyword).createQuery();
</code></pre>

<p>Keywordë¥¼ ì…ë ¥ë°›ì•„ title ì»¬ëŸ¼ì—ì„œ ê²€ìƒ‰í•˜ëŠ” ê°€ì¥ ê¸°ë³¸ì ì¸ ì¿¼ë¦¬ì…ë‹ˆë‹¤. ìœ„ì˜ ì¿¼ë¦¬ì—ì„œ onField() ëŒ€ì‹  <strong>onFields(â€œAâ€, â€œBâ€)</strong>ë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ ì—¬ëŸ¬ê°œì˜ ì»¬ëŸ¼ì—ì„œ ê²€ìƒ‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. Hibernate Searchì™€ Luceneì€ ê¸°ë³¸ì ìœ¼ë¡œ indexì—ì„œ ê³µë°±ë¬¸ìë¥¼ ê¸°ì¤€ìœ¼ë¡œ Keywordì™€ ë§¤ì¹­í•©ë‹ˆë‹¤.<br />
í•˜ì§€ë§Œ ì €ëŠ” â€˜Sparkâ€™ë¥¼ ê²€ìƒ‰ ì‹œ â€˜Sparkâ€™ ë¿ë§Œ ì•„ë‹ˆë¼ â€˜SparkMLâ€™ ì´ë‚˜ â€˜TensorflowOnSparkâ€™ ì™€ ê°™ì´ â€˜Sparkâ€™ ê°€ í¬í•¨ëœ Keywordë¥¼ ëª¨ë‘ ì°¾ê³  ì‹¶ìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì´ ì™€ì¼ë“œì¹´ë“œ ê¸°ëŠ¥ì…ë‹ˆë‹¤.</p>
<pre><code>Query query = queryBuilder.keyword().wildcard().onField("title")
                .matching("*"+keyword+"*").createQuery();
</code></pre>

<p>ìœ„ì™€ ê°™ì´ wildcard()ë¥¼ ë„£ì–´ì£¼ê³  matching() ë©”ì†Œë“œ ì•ˆì— Keywordì™€ ê°™ì´ â€˜*â€™ ì™€ì¼ë“œì¹´ë“œë¥¼ ì¸ìê°’ìœ¼ë¡œ ë„£ì–´ì£¼ë©´ ë©ë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ ì™€ì¼ë“œì¹´ë“œë¥¼ ì•ë’¤ë¡œ ë¶™ì´ë©´ ë¶ˆí•„ìš”í•œ ê²°ê³¼ê°’ë“¤ì´ ë§ì´ í¬í•¨ëœë‹¤ê³  í•˜ì§€ë§Œ ì €ëŠ” ì•ì—ì„œ ì–¸ê¸‰í–ˆë“¯ì´ ì•ë’¤ ëª¨ë‘ì˜ í¬í•¨ì—¬ë¶€ë¥¼ ì•Œê³ ì‹¶ê¸°ì— ì´ë ‡ê²Œ ì¿¼ë¦¬ë¥¼ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.<br />
ë§ˆì§€ë§‰ìœ¼ë¡œ FullTextEntityManagerì˜ createFullTextQuery ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•´ Lucene ì¿¼ë¦¬ë¥¼ Hibernate Search FullTextQueryë¡œ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.</p>
<pre><code>FullTextQuery fullTextQuery = fullTextEntityManager.createFullTextQuery(query, Board.class);</code></pre>

<p>ì•„ë˜ëŠ” ì „ì²´ ì½”ë“œì…ë‹ˆë‹¤.</p>
<pre><code>package com.hoyy.test.Services;

import java.util.List;

import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;
import javax.persistence.PersistenceContextType;

import org.apache.lucene.search.Query;
import org.hibernate.search.jpa.FullTextEntityManager;
import org.hibernate.search.jpa.FullTextQuery;
import org.hibernate.search.jpa.Search;
import org.hibernate.search.query.dsl.QueryBuilder;
import org.springframework.stereotype.Service;

import com.hoyy.test.models.Board;

@Service
public class HibernateSearchService {
	@PersistenceContext(type=PersistenceContextType.EXTENDED)
	private EntityManager entityManager;
	
	public void buildIndex() throws InterruptedException {
		FullTextEntityManager fullTextEntityManager = Search.getFullTextEntityManager(entityManager);
		fullTextEntityManager.createIndexer().startAndWait();
	}
	
	@SuppressWarnings("unchecked")
	public List&lt;Board&gt; searchBoards(String keyword) {
		FullTextEntityManager fullTextEntityManager = Search.getFullTextEntityManager(entityManager);
		QueryBuilder queryBuilder = fullTextEntityManager.getSearchFactory()
									.buildQueryBuilder().forEntity(Board.class).get();
		Query query = queryBuilder.keyword().wildcard().onField("title")
						.matching("*"+keyword+"*").createQuery();
		FullTextQuery fullTextQuery = fullTextEntityManager.createFullTextQuery(query, Board.class);
		
		return (List&lt;Board&gt;) fullTextQuery.getResultList();
	}
}
</code></pre>

<hr />

<h1 id="5-arirang-ì ìš©">5. Arirang ì ìš©</h1>

<p>ë§ˆì§€ë§‰ìœ¼ë¡œ í•œê¸€ ê²€ìƒ‰ì„ ìœ„í•´ Lucene Korean Analyzerì¸ ì•„ë¦¬ë‘ì„ ì ìš©í•˜ì˜€ìŠµë‹ˆë‹¤. ì•„ë¦¬ë‘ jar íŒŒì¼ì€ ìˆ˜ëª…ë‹˜ê»˜ì„œ ìš´ì˜ì¤‘ì´ì‹  korlucene ì¹´í˜ì—ì„œ ë‹¤ìš´ë°›ì•˜ìœ¼ë©°, ê´€ë ¨ ë‚´ìš©ì€ ì•„ë˜ ë¸”ë¡œê·¸ì— ìì„¸íˆ ë‚˜ì™€ìˆì–´ ì°¸ê³ í•˜ì˜€ìŠµë‹ˆë‹¤.<br />
<a href="https://hihoyeho.tistory.com/entry/Spring-Boot-Hibernate-Search-Lucene%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EA%B2%80%EC%83%89%EA%B8%B0%EB%8A%A5-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0">https://hihoyeho.tistory.com/entry/Spring-Boot-Hibernate-Search-Lucene%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EA%B2%80%EC%83%89%EA%B8%B0%EB%8A%A5-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0</a><br />
ì°¸ê³ ë¡œ Gradleì— ë‹¤ìš´ë°›ì€ jar íŒŒì¼ì„ ì¶”ê°€í•˜ëŠ” ë°©ë²•ì€ ì•„ë˜ì™€ ê°™ì´ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— jar íŒŒì¼ì„ ìœ„ì¹˜ì‹œí‚¤ê³  í•´ë‹¹ ê²½ë¡œë¥¼ build.gradleì— ì¶”ê°€í•´ ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.</p>
<pre><code>dependencies {
    ...
    compile files('libs/arirang-morph-1.0.0.jar')
    compile files('libs/arirang.lucene-analyzer-5.0-1.0.0.jar')
    ...
}
</code></pre>

<hr />
<p>[ì°¸ê³  ì‚¬ì´íŠ¸]<br />
<a href="https://hibernate.org/search/">https://hibernate.org/search/</a><br />
<a href="https://www.baeldung.com/hibernate-search">https://www.baeldung.com/hibernate-search</a><br />
<a href="http://hibernate.org/search/documentation/getting-started/#indexing">http://hibernate.org/search/documentation/getting-started/#indexing</a><br />
<a href="https://hihoyeho.tistory.com/entry/Spring-Boot-Hibernate-Search-Lucene%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EA%B2%80%EC%83%89%EA%B8%B0%EB%8A%A5-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0">https://hihoyeho.tistory.com/entry/Spring-Boot-Hibernate-Search-Lucene%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EA%B2%80%EC%83%89%EA%B8%B0%EB%8A%A5-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0</a></p>
:ET